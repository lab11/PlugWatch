// Generated by CoffeeScript 1.6.3
(function() {
  var isInteger;

  isInteger = function(n) {
    return typeof n === 'number' && n % 1 === 0;
  };

  module.exports = function(done) {
    var counter, error, results;
    counter = 0;
    error = null;
    results = [];
    return function(ref) {
      var called;
      if (!isInteger(ref) && results === []) {
        results = {};
      }
      ref || (ref = counter);
      counter++;
      called = false;
      return function(err, result) {
        return process.nextTick(function() {
          if (error) {
            return;
          }
          if (called) {
            return;
          }
          called = true;
          if (err) {
            error = err;
            return done(err, results);
          }
          results[ref] = result;
          if (--counter === 0) {
            return done(null, results);
          }
        });
      };
    };
  };

}).call(this);
